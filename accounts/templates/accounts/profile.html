{% extends 'base.html' %}
{% load rights %}
{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}
{% block content %}
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-4 text-center">
                {% if user.avatar %}
                    <img src="{{ user.avatar.url }}" class="img-thumbnail rounded-circle mb-3" width="200" height="200">
                {% else %}
                    <i class="fs-1 bi bi-person-square"></i>
                {% endif %}
                <h4>{{ user.get_full_name|default:user.username }}</h4>
                {% if user.status_message %}
                    <p class="text-muted">{{ user.status_message }}</p>
                {% endif %}
                {% if user.is_superuser %}
                    <a href="{% url 'admin:index' %}" class="btn btn-outline-dark btn-sm">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                {% endif %}

            </div>

            <div class="col-md-8">
                <h5 class="mb-3">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                <ul class="list-group list-group-flush mb-3">
                    {% if user.email %}
                        <li class="list-group-item"><strong>Email:</strong> {{ user.email }}</li>
                    {% endif %}
                    {% if user.website %}
                        <li class="list-group-item"><strong>–í–µ–±-—Å–∞–π—Ç:</strong> <a href="{{ user.website }}"
                                                                                  target="_blank">{{
                                user.website }}</a></li>
                    {% endif %}
                    {% if user.location %}
                        <li class="list-group-item"><strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ user.location }}</li>
                    {% endif %}
                    {% if user.date_of_birth %}
                        <li class="list-group-item"><strong>–î–∞—Ç–∞
                            —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ user.date_of_birth|date:"d.m.Y" }}</li>
                    {% endif %}
                </ul>

                {% if user.bio %}
                    <h5 class="mb-2">–û —Å–µ–±–µ</h5>
                    <p>{{ user.bio|linebreaks }}</p>
                {% endif %}

                {% if user.telegram or user.whatsapp or user.viber %}
                    <h5 class="mt-4">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã</h5>
                    <ul class="list-group list-group-flush">
                        {% if user.telegram %}
                            <li class="list-group-item"><strong>Telegram:</strong> @{{ user.telegram }}</li>
                        {% endif %}
                        {% if user.whatsapp %}
                            <li class="list-group-item"><strong>WhatsApp:</strong> {{ user.whatsapp }}</li>
                        {% endif %}
                        {% if user.viber %}
                            <li class="list-group-item"><strong>Viber:</strong> {{ user.viber }}</li>
                        {% endif %}
                    </ul>
                {% endif %}
            </div>
        </div>
        {% if posts %}
            <hr class="my-5">
            <h4>–í–∞—à–∏ –ø–æ—Å—Ç—ã</h4>
            {% for post in posts %}
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between">
                        <h5>{{ post.title }}</h5>
                        <small class="text-muted">{{ post.created_at|date:"d.m.Y H:i" }}</small>
                    </div>
                    <div class="card-body">
                        <p>{{ post.content|linebreaks|truncatechars:200 }}</p>
                        {% if post.image %}
                            <img src="{{ post.image.url }}" class="img-fluid rounded" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                        {% endif %}
                        {% if post|can_edit_post:user %}
                            <div class="mt-2">
                                <a href="{% url 'social:post_edit' post.pk %}"
                                   class="btn btn-sm btn-outline-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                            </div>
                        {% endif %}
                    </div>
                    <div class="card-footer text-muted d-flex flex-column flex-sm-row justify-content-between gap-2">
                        <div class="d-flex flex-column flex-sm-row justify-content-between gap-1">
                            {% if user|can_interact %}
                                <form class="like-form" data-post-id="{{ post.pk }}" method="post"
                                      action="{% url 'social:post_like_toggle' post.pk %}">
                                    {% csrf_token %}
                                    <button type="submit"
                                            class="like-button btn btn-sm {% if user in post.likes.all %}btn-danger{% else %}btn-outline-danger{% endif %}">
                                        ‚ù§ <span class="like-count">{{ post.likes.count }}</span>
                                    </button>
                                </form>
                            {% else %}
                                ‚ù§ {{ post.likes.count }}
                            {% endif %}
                            &nbsp;&nbsp; üí¨ {{ post.comments.count }}&nbsp;&nbsp;&nbsp;&nbsp;
                            <div>
                                <a href="{% url 'social:post_detail' post.pk %}" class="btn btn-sm btn-outline-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                            </div>
                            {% if post|can_edit_post:user %}
                                <div>
                                    <a href="{% url 'social:post_edit' post.pk %}"
                                       class="btn btn-sm btn-outline-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                                </div>
                            {% endif %}
                        </div>
                        <div>
                            {% if post.author %}
                                –ê–≤—Ç–æ—Ä:
                                <a href="{% url 'accounts:public_profile' post.author.username %}">{{ post.author.username }}</a>
                            {% else %}
                                <span class="text-muted">–ê–≤—Ç–æ—Ä —É–¥–∞–ª—ë–Ω</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% empty %}
                <p>–í—ã –ø–æ–∫–∞ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞.</p>
            {% endfor %}
        {% endif %}
    </div>
{% endblock %}
