{% extends 'base.html' %}
{% load rights %}
{% block content %}
    <div class="container">
        <h2>{{ profile_user.username }}</h2>
        {% if profile_user.avatar %}
            <img src="{{ profile_user.avatar.url }}" alt="Avatar" class="img-thumbnail mb-2" style="max-width: 150px;">
        {% endif %}
        <p><strong>–ò–º—è:</strong> {{ profile_user.first_name }} {{ profile_user.last_name }}</p>
        <p><strong>–°–µ–π—á–∞—Å:</strong> {{ profile_user.status_message }}</p>
        <p><strong>–û —Å–µ–±–µ:</strong> {{ profile_user.bio }}</p>
        <p><strong>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:</strong> {{ profile_user.date_joined|date:"d.m.Y" }}</p>
        <p>
            –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {{ followers_count }}<br>
            –ü–æ–¥–ø–∏—Å–æ–∫: {{ following_count }}
        </p>
        {% if user.is_authenticated and user != profile_user and user|can_interact %}
            <form action="{% url 'accounts:toggle_follow' profile_user.username %}"
                  method="post"
                  class="ajax-follow-toggle ajax-follow-reload d-inline">
                {% csrf_token %}
                <button type="submit"
                        class="btn btn-sm {% if profile_user in request.user.following.all %}btn-primary{% else %}btn-outline-primary{% endif %}">
                    {% if profile_user in request.user.following.all %}–û—Ç–ø–∏—Å–∞—Ç—å—Å—è{% else %}–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è{% endif %}
                </button>
            </form>

        {% endif %}
        <hr>
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header">
                        –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ ({{ followers_count }})
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for follower in profile_user.followers.all %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="{% url 'accounts:public_profile' follower.username %}">
                                    {{ follower.username }}
                                </a>

                                {% if user.is_authenticated and user != follower and follower not in user.following.all %}
                                    <form action="{% url 'accounts:toggle_follow' follower.username %}"
                                          method="post"
                                          class="ajax-follow-toggle ajax-follow-reload d-inline">
                                        {% csrf_token %}
                                        <button type="submit"
                                                class="btn btn-sm {% if follower in request.user.following.all %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                            {% if follower in request.user.following.all %}–û—Ç–ø–∏—Å–∞—Ç—å—Å—è{% else %}
                                                –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è{% endif %}
                                        </button>
                                    </form>
                                {% endif %}
                            </li>
                        {% empty %}
                            <li class="list-group-item text-muted">–ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header">
                        –ü–æ–¥–ø–∏—Å–∫–∏ ({{ following_count }})
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for following in profile_user.following.all %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="{% url 'accounts:public_profile' following.username %}">
                                    {{ following.username }}
                                </a>
                                {% if user.is_authenticated and user == profile_user %}
                                    <form action="{% url 'accounts:toggle_follow' following.username %}"
                                          method="post"
                                          class="ajax-follow-toggle ajax-follow-reload d-inline">
                                        {% csrf_token %}
                                        <button type="submit"
                                                class="btn btn-sm {% if following in user.following.all %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                            {% if following in user.following.all %}–û—Ç–ø–∏—Å–∞—Ç—å—Å—è{% else %}
                                                –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è{% endif %}
                                        </button>
                                    </form>
                                {% endif %}
                            </li>
                        {% empty %}
                            <li class="list-group-item text-muted">–ù–∏ –Ω–∞ –∫–æ–≥–æ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>


        <hr>
        <h4>–ü–æ—Å—Ç—ã</h4>
        {% for post in posts %}
            <div class="card mb-3">
                <div class="card-header text-muted d-flex flex-column flex-sm-row justify-content-between gap-2">
                    <h5>{{ post.title }}</h5>
                    <small class="text-muted">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ post.created_at|date:"d.m.Y H:i" }}</small>
                </div>
                <div class="card-body">
                    <p>{{ post.content|truncatewords:30 }}</p>
                </div>
                <div class="card-footer">
                    <div class="d-flex flex-column flex-sm-row justify-content-left gap-1">
                        {% if user|can_interact %}
                            <form class="like-form" data-post-id="{{ post.pk }}" method="post"
                                  action="{% url 'social:post_like_toggle' post.pk %}">
                                {% csrf_token %}
                                <button type="submit"
                                        class="like-button btn btn-sm {% if user in post.likes.all %}btn-danger{% else %}btn-outline-danger{% endif %}">
                                    ‚ù§ <span class="like-count">{{ post.likes.count }}</span>
                                </button>
                            </form>
                        {% else %}
                            ‚ù§ {{ post.likes.count }}
                        {% endif %}
                        &nbsp;&nbsp; üí¨ {{ post.comments.count }}&nbsp;&nbsp;&nbsp;&nbsp;
                        <div>
                            <a href="{% url 'social:post_detail' post.pk %}" class="btn btn-sm btn-outline-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>–ù–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤.</p>
        {% endfor %}
    </div>
{% endblock %}
